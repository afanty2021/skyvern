# Agent æ¨¡å—æ–‡æ¡£

> ğŸ“ **ä½ç½®**: [skyvern](../CLAUDE.md) â†’ agent

## æ¨¡å—æ¦‚è¿°

Agent æ¨¡å—æ˜¯ Skyvern çš„æ ¸å¿ƒ AI ä»£ç†ç³»ç»Ÿï¼Œè´Ÿè´£ä»»åŠ¡è§„åˆ’ã€å†³ç­–åˆ¶å®šå’Œæ™ºèƒ½ç½‘é¡µäº¤äº’ã€‚è¯¥æ¨¡å—ä½¿ç”¨ LLM åˆ†æç½‘é¡µæˆªå›¾ï¼Œç†è§£ä»»åŠ¡ç›®æ ‡ï¼Œå¹¶ç”Ÿæˆç›¸åº”çš„æµè§ˆå™¨æ“ä½œæŒ‡ä»¤ã€‚

## æ–‡ä»¶ç»“æ„

```
skyvern/agent/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ agent.py                 # ä¸»ä»£ç†ç±»å®šä¹‰
â”œâ”€â”€ actions.py               # åŠ¨ä½œç”Ÿæˆå’Œç®¡ç†
â”œâ”€â”€ analyzer.py              # ç½‘é¡µåˆ†æå™¨
â”œâ”€â”€ decision_maker.py        # å†³ç­–åˆ¶å®šé€»è¾‘
â”œâ”€â”€ memory.py                # è®°å¿†ç®¡ç†
â”œâ”€â”€ planner.py               # ä»»åŠ¡è§„åˆ’
â””â”€â”€ prompts/                 # æç¤ºè¯æ¨¡æ¿
    â”œâ”€â”€ __init__.py
    â”œâ”€â”€ analysis_prompts.py  # é¡µé¢åˆ†ææç¤ºè¯
    â””â”€â”€ action_prompts.py    # åŠ¨ä½œç”Ÿæˆæç¤ºè¯
```

## æ ¸å¿ƒåŠŸèƒ½

### 1. Agent ä¸»ç±» (`agent.py`)
- **èŒè´£**: æ ¸å¿ƒä»£ç†é€»è¾‘ï¼Œåè°ƒå„ä¸ªç»„ä»¶
- **å…³é”®ç±»**: `WebAgent`
- **ä¸»è¦æ–¹æ³•**:
  - `execute_task()`: æ‰§è¡Œç”¨æˆ·ä»»åŠ¡
  - `analyze_page()`: åˆ†æå½“å‰é¡µé¢çŠ¶æ€
  - `decide_action()`: å†³å®šä¸‹ä¸€æ­¥åŠ¨ä½œ
  - `update_memory()`: æ›´æ–°ä»£ç†è®°å¿†

### 2. åŠ¨ä½œç³»ç»Ÿ (`actions.py`)
- **èŒè´£**: å°† LLM å†³ç­–è½¬æ¢ä¸ºå…·ä½“çš„æµè§ˆå™¨æ“ä½œ
- **æ”¯æŒçš„åŠ¨ä½œç±»å‹**:
  - å¯¼èˆªæ“ä½œï¼ˆç‚¹å‡»ã€æ»šåŠ¨ï¼‰
  - è¾“å…¥æ“ä½œï¼ˆæ–‡æœ¬å¡«å†™ã€æ–‡ä»¶ä¸Šä¼ ï¼‰
  - é€‰æ‹©æ“ä½œï¼ˆä¸‹æ‹‰èœå•ã€å•é€‰æ¡†ï¼‰
  - éªŒè¯æ“ä½œï¼ˆéªŒè¯ç è¯†åˆ«ã€éªŒè¯å…ƒç´ ï¼‰

### 3. é¡µé¢åˆ†æå™¨ (`analyzer.py`)
- **èŒè´£**: ç†è§£ç½‘é¡µç»“æ„å’Œå†…å®¹
- **åˆ†æç»´åº¦**:
  - DOM ç»“æ„åˆ†æ
  - äº¤äº’å…ƒç´ è¯†åˆ«
  - è¡¨å•å­—æ®µæ£€æµ‹
  - å…³é”®ä¿¡æ¯æå–

### 4. å†³ç­–åˆ¶å®šå™¨ (`decision_maker.py`)
- **èŒè´£**: åŸºäºåˆ†æç»“æœåˆ¶å®šæ“ä½œå†³ç­–
- **å†³ç­–å› ç´ **:
  - ä»»åŠ¡ç›®æ ‡
  - å½“å‰é¡µé¢çŠ¶æ€
  - å†å²æ“ä½œè®°å½•
  - é”™è¯¯å¤„ç†ç­–ç•¥

### 5. è®°å¿†ç®¡ç† (`memory.py`)
- **èŒè´£**: ç»´æŠ¤ä»£ç†çš„çŸ­æœŸå’Œé•¿æœŸè®°å¿†
- **è®°å¿†ç±»å‹**:
  - ä¼šè¯è®°å¿†ï¼ˆå½“å‰ä»»åŠ¡ä¸Šä¸‹æ–‡ï¼‰
  - å†å²è®°å¿†ï¼ˆè¿‡å»çš„æˆåŠŸç»éªŒï¼‰
  - æ¨¡å¼è®°å¿†ï¼ˆå¸¸è§çš„ç½‘ç«™æ¨¡å¼ï¼‰

### 6. ä»»åŠ¡è§„åˆ’å™¨ (`planner.py`)
- **èŒè´£**: å°†å¤æ‚ä»»åŠ¡åˆ†è§£ä¸ºå¯æ‰§è¡Œçš„æ­¥éª¤
- **è§„åˆ’ç­–ç•¥**:
  - ç›®æ ‡åˆ†è§£
  - æ­¥éª¤æ’åº
  - å¼‚å¸¸å¤„ç†è§„åˆ’
  - å›æ»šç­–ç•¥

## æç¤ºè¯ç³»ç»Ÿ

### åˆ†ææç¤ºè¯ (`prompts/analysis_prompts.py`)
```python
PAGE_ANALYSIS_PROMPT = """
åˆ†æä»¥ä¸‹ç½‘é¡µæˆªå›¾ï¼Œè¯†åˆ«ï¼š
1. é¡µé¢ç±»å‹ï¼ˆç™»å½•é¡µã€è¡¨å•é¡µã€åˆ—è¡¨é¡µç­‰ï¼‰
2. å…³é”®äº¤äº’å…ƒç´ 
3. è¡¨å•å­—æ®µåŠå…¶ç”¨é€”
4. å¯èƒ½çš„å¯¼èˆªè·¯å¾„
5. éœ€è¦æ³¨æ„çš„å¼‚å¸¸æƒ…å†µ
"""

ELEMENT_DETECTION_PROMPT = """
åœ¨é¡µé¢ä¸­å®šä½å¹¶æè¿°ï¼š
- æŒ‰é’®åŠå…¶å¯èƒ½çš„æ“ä½œ
- è¾“å…¥æ¡†åŠå…¶é¢„æœŸè¾“å…¥ç±»å‹
- é“¾æ¥åŠå…¶ç›®æ ‡
- é”™è¯¯æ¶ˆæ¯æˆ–éªŒè¯æç¤º
"""
```

### åŠ¨ä½œæç¤ºè¯ (`prompts/action_prompts.py`)
```python
ACTION_GENERATION_PROMPT = """
åŸºäºä»»åŠ¡ç›®æ ‡å’Œé¡µé¢åˆ†æï¼Œç”Ÿæˆä¸‹ä¸€æ­¥åŠ¨ä½œï¼š
1. é€‰æ‹©åˆé€‚çš„åŠ¨ä½œç±»å‹
2. æŒ‡å®šç›®æ ‡å…ƒç´ ï¼ˆä½¿ç”¨é€‰æ‹©å™¨ï¼‰
3. è®¾ç½®åŠ¨ä½œå‚æ•°
4. é¢„æœŸç»“æœæè¿°
"""

ERROR_HANDLING_PROMPT = """
å½“åŠ¨ä½œå¤±è´¥æ—¶ï¼š
1. åˆ†æå¤±è´¥åŸå› 
2. é€‰æ‹©æ¢å¤ç­–ç•¥
3. è°ƒæ•´åŠ¨ä½œå‚æ•°
4. å†³å®šæ˜¯å¦é‡è¯•
"""
```

## å…³é”®é…ç½®

### LLM é…ç½®
```python
# æ”¯æŒçš„ LLM æä¾›å•†
LLM_PROVIDERS = {
    "openai": "gpt-4-vision-preview",
    "anthropic": "claude-3-opus",
    "azure": "gpt-4-vision",
    "gemini": "gemini-pro-vision"
}

# é»˜è®¤é…ç½®
DEFAULT_LLM_CONFIG = {
    "temperature": 0.1,
    "max_tokens": 2048,
    "timeout": 30
}
```

### åŠ¨ä½œé…ç½®
```python
# åŠ¨ä½œè¶…æ—¶è®¾ç½®
ACTION_TIMEOUTS = {
    "click": 10,
    "input": 15,
    "scroll": 5,
    "wait": 30
}

# é‡è¯•ç­–ç•¥
MAX_RETRIES = 3
RETRY_DELAY = 2  # seconds
```

## ä¸å…¶ä»–æ¨¡å—çš„é›†æˆ

### ä¸ WebEye é›†æˆ
- æ¥æ”¶é¡µé¢æˆªå›¾å’Œ DOM æ•°æ®
- å‘é€æµè§ˆå™¨æ“ä½œæŒ‡ä»¤
- è·å–æ“ä½œæ‰§è¡Œç»“æœ

### ä¸ Services é›†æˆ
- ä¿å­˜æ‰§è¡Œå†å²
- è®°å½•ä»»åŠ¡çŠ¶æ€
- è·å–ç”¨æˆ·é…ç½®

### ä¸ Forge é›†æˆ
- é€šè¿‡ API æ¥æ”¶ä»»åŠ¡
- å‘é€çŠ¶æ€æ›´æ–°
- å¤„ç†å®æ—¶è¯·æ±‚

## æ€§èƒ½ä¼˜åŒ–

### 1. æç¤ºè¯ä¼˜åŒ–
- ä½¿ç”¨ç®€æ´çš„æç¤ºè¯æ¨¡æ¿
- å®æ–½æç¤ºè¯ç¼“å­˜
- æ‰¹é‡å¤„ç†ç›¸ä¼¼è¯·æ±‚

### 2. è®°å¿†ä¼˜åŒ–
- é™åˆ¶è®°å¿†çª—å£å¤§å°
- å‹ç¼©å†å²è®°å½•
- ä¼˜å…ˆçº§æ’åº

### 3. å†³ç­–ä¼˜åŒ–
- é¢„æµ‹å¸¸è§æ“ä½œæ¨¡å¼
- ç¼“å­˜å†³ç­–ç»“æœ
- å¹¶è¡Œå¤„ç†å¤šä¸ªé€‰é¡¹

## é”™è¯¯å¤„ç†

### å¸¸è§é”™è¯¯ç±»å‹
1. **é¡µé¢åŠ è½½å¤±è´¥**
   - æ£€æµ‹ç½‘ç»œçŠ¶æ€
   - å°è¯•åˆ·æ–°é¡µé¢
   - è®°å½•é”™è¯¯è¯¦æƒ…

2. **å…ƒç´ å®šä½å¤±è´¥**
   - ä½¿ç”¨å¤‡é€‰é€‰æ‹©å™¨
   - ç­‰å¾…å…ƒç´ å‡ºç°
   - æ¨¡æ‹Ÿäººç±»è¡Œä¸º

3. **åŠ¨ä½œæ‰§è¡Œå¤±è´¥**
   - åˆ†æå¤±è´¥åŸå› 
   - è°ƒæ•´åŠ¨ä½œå‚æ•°
   - æ‰§è¡Œæ¢å¤æ“ä½œ

4. **LLM å“åº”å¼‚å¸¸**
   - éªŒè¯å“åº”æ ¼å¼
   - ä½¿ç”¨å¤‡é€‰æç¤ºè¯
   - é™çº§åˆ°è§„åˆ™é€»è¾‘

## æµ‹è¯•ç­–ç•¥

### å•å…ƒæµ‹è¯•
- æµ‹è¯•å„ä¸ªç»„ä»¶çš„ç‹¬ç«‹åŠŸèƒ½
- æ¨¡æ‹Ÿ LLM å“åº”
- éªŒè¯å†³ç­–é€»è¾‘

### é›†æˆæµ‹è¯•
- æµ‹è¯•æ¨¡å—é—´çš„äº¤äº’
- ä½¿ç”¨çœŸå®æµè§ˆå™¨ç¯å¢ƒ
- éªŒè¯ç«¯åˆ°ç«¯æµç¨‹

### æ€§èƒ½æµ‹è¯•
- æµ‹é‡å“åº”æ—¶é—´
- ç›‘æ§èµ„æºä½¿ç”¨
- ä¼˜åŒ–å…³é”®è·¯å¾„

## å¼€å‘æŒ‡å—

### æ·»åŠ æ–°çš„åŠ¨ä½œç±»å‹
1. åœ¨ `actions.py` ä¸­å®šä¹‰æ–°åŠ¨ä½œ
2. æ›´æ–°æç¤ºè¯æ¨¡æ¿
3. å®ç°æ‰§è¡Œé€»è¾‘
4. æ·»åŠ æµ‹è¯•ç”¨ä¾‹

### æ”¹è¿›å†³ç­–é€»è¾‘
1. åˆ†æå†å²æ•°æ®
2. è¯†åˆ«æ”¹è¿›ç‚¹
3. æ›´æ–°å†³ç­–ç®—æ³•
4. A/B æµ‹è¯•æ•ˆæœ

### ä¼˜åŒ–æç¤ºè¯
1. æ”¶é›†å¤±è´¥æ¡ˆä¾‹
2. åˆ†ææç¤ºè¯æ•ˆæœ
3. è¿­ä»£æ”¹è¿›æ¨¡æ¿
4. è¯„ä¼°æ€§èƒ½æå‡

## æœªæ¥è§„åˆ’

### çŸ­æœŸç›®æ ‡
- æ”¯æŒæ›´å¤šç½‘ç«™ç±»å‹
- æé«˜åŠ¨ä½œæˆåŠŸç‡
- å‡å°‘å“åº”å»¶è¿Ÿ

### é•¿æœŸç›®æ ‡
- è‡ªå­¦ä¹ èƒ½åŠ›çš„å®ç°
- å¤šä»»åŠ¡å¹¶è¡Œå¤„ç†
- å¤æ‚ä»»åŠ¡è‡ªåŠ¨åˆ†è§£

---

> ğŸ“– **è¿”å›**: [Skyvern æ ¹æ–‡æ¡£](../CLAUDE.md) | [WebEye æ¨¡å—](../webeye/CLAUDE.md) | [Services æ¨¡å—](../services/CLAUDE.md)